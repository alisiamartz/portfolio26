---
import BaseLayout from "./BaseLayout.astro";
import Pill from "../components/Pill.astro";
import Media from "../components/Media.astro";

const { entry } = Astro.props;
const data = entry.data;

// Precompute view-model-y stuff once
const roles = data.roles ?? [];
const tags = data.tags ?? [];
const hasTimeline = Boolean(data.timeline);
const toolsText = (data.tools?.length ?? 0) > 0 ? data.tools.join(" â€¢ ") : null;

const hero = data.hero; // { type?, src, alt? } (whatever your schema is)
const atAGlance = data.atAGlance; // { problem, built, impact }
---

<BaseLayout title={`Alisia Martinez - ${data.title}`} description={data.description}>
  <article class="case">
    <header class="case__header">
      <h1 class="case__title text-4xl md:text-5xl font-semibold tracking-tight">{data.title}</h1>

      {data.description && <p class="case__desc">{data.description}</p>}

      {(roles.length || tags.length) > 0 && (
        <div class="case__pills">
          {roles.map((r) => <Pill text={r} tone="muted" />)}
          {tags.map((t) => <Pill text={t} tone="default" />)}
        </div>
      )}

      <dl class="case__meta">
        {hasTimeline && (
          <>
            <dt>Timeline</dt>
            <dd>{data.timeline}</dd>
          </>
        )}

        {toolsText && (
          <>
            <dt>Tools</dt>
            <dd>{toolsText}</dd>
          </>
        )}
      </dl>
    </header>

    {hero && (
      <section class="case__hero">
        {/* adjust props to match your hero shape */}
        <Media type={hero.type ?? "image"} src={hero.src} alt={hero.alt ?? data.title} />
      </section>
    )}

    {atAGlance && (
      <section class="case__ataglance">
        <div class="grid3">
          <div class="card">
            <h2>Problem</h2>
            <p>{atAGlance.problem}</p>
          </div>
          <div class="card">
            <h2>What I built</h2>
            <p>{atAGlance.built}</p>
          </div>
          <div class="card">
            <h2>Impact</h2>
            <p>{atAGlance.impact}</p>
          </div>
        </div>
      </section>
    )}

    <section class="case__body">
      <slot />
    </section>
  </article>
</BaseLayout>

<style>
  /* keep/replace with your existing styling system */
  .case { max-width: 980px; margin: 0 auto; padding: 48px 20px; }
  .case__header { display: grid; gap: 16px; }
  .case__title { margin: 0; }
  .case__desc { margin: 0; opacity: 0.9; }
  .case__pills { display: flex; flex-wrap: wrap; gap: 8px; }
  .case__meta { display: grid; grid-template-columns: 120px 1fr; gap: 8px 16px; margin: 8px 0 0; }
  .case__meta dt { opacity: 0.7; }
  .case__meta dd { margin: 0; }
  .case__hero { margin-top: 24px; }
  .case__ataglance { margin-top: 28px; }
  .grid3 { display: grid; gap: 16px; grid-template-columns: repeat(3, minmax(0, 1fr)); }
  .card { border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 16px; }
  .case__body { margin-top: 36px; }
  @media (max-width: 800px) { .grid3 { grid-template-columns: 1fr; } .case__meta { grid-template-columns: 1fr; } }
</style>
